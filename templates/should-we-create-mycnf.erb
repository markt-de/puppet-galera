#!/bin/bash
set -e

test ` cat <%= @facts['root_home'] %>/.my.cnf | /bin/grep -c "password='<%= @root_password %>'" ` -eq 0

for TRY in $( seq 0 30 )
do
  if /usr/bin/mysql --user=root --password=<%= @root_password %> -e 'select count(1);' 2>&1 | grep -i 'ACCESS DENIED'
  then
    # ACCESS DENIED
    exit 1
  fi

  if ! /usr/bin/mysql --user=root --password=<%= @root_password %> -e 'select count(1);' | grep '1'
  then
    sleep 1
  else
    exit 0
  fi
done
